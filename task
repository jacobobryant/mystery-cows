#!/bin/bash
set -e

sass () {
  npx node-sass "$@" bootstrap/custom.scss public/css/bootstrap.css
}

setup () {
  npm install live-server onchange node-sass
  if ! [ -d bootstrap/bootstrap-4.4.1 ]; then
    cd bootstrap
    curl -OL -o archive.zip https://github.com/twbs/bootstrap/archive/v4.4.1.zip
    unzip archive.zip
    rm archive.zip
  fi
  curl -o public/css/firebase-ui-auth-4.4.0.css https://www.gstatic.com/firebasejs/ui/4.4.0/firebase-ui-auth.css
  curl -o public/js/firebase-ui-auth-4.4.0.js https://www.gstatic.com/firebasejs/ui/4.4.0/firebase-ui-auth.js
}

dev () {
  sass
  sass -w &
  if ! [ -f public/index.html ]; then
    clj -m cows.core
  fi
  if [ "$1" = live ]; then
    (cd public && npx live-server) &
  else
    firebase serve &
  fi
  npx onchange -v 'src/**/*.clj' -- clj -m cows.core
}

deploy () {
  sass
  clj -m cows.core
  firebase deploy
}

"$@"
